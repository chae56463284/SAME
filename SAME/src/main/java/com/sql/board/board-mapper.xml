<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
	
	<entry key="selectBoardList">
	SELECT *
	FROM   (SELECT ROWNUM RNUM, A.*
			FROM (SELECT BOARD_NO, MEMBER_NAME, BOARD_TITLE, CREATE_DATE, COUNT
					FROM BOARD B
					JOIN MEMBER M USING (MEMBER_NO)
					WHERE IS_DELETE = 'N'
					ORDER BY BOARD_NO DESC) A
			)
	WHERE RNUM BETWEEN ? AND ?
	</entry>
	
	<entry key="selectListCount">
		SELECT COUNT(*)
		FROM BOARD
		WHERE IS_DELETE = 'N'
	</entry>
	
		<entry key="selectBoardListC">
	SELECT *
	FROM   (SELECT ROWNUM RNUM, A.*
			FROM (SELECT BOARD_NO, MEMBER_NAME, BOARD_TITLE, CREATE_DATE, COUNT
					FROM BOARD B
					JOIN MEMBER M USING (MEMBER_NO)
					WHERE IS_DELETE = 'N'
					AND BOARD_TYPE = 'c'
					ORDER BY BOARD_NO DESC) A
			)
	WHERE RNUM BETWEEN ? AND ?
	</entry>
	
	
	
	
	
	
	<entry key="selectBoard">
		SELECT 
			BOARD_NO, CATEGORY_NAME, BOARD_TITLE, BOARD_CONTENT,
			USER_ID, CREATE_DATE, FILE_NO, ORIGIN_NAME, CHANGE_NAME, FILE_PATH
		FROM BOARD B
		LEFT JOIN CATEGORY C USING(CATEGORY_NO)
		JOIN MEMBER M ON B.BOARD_WRITER = USER_NO
		LEFT JOIN ATTACHMENT A ON (BOARD_NO = REF_BNO) AND A.STATUS = 'Y'
		WHERE BOARD_NO = ?
		    AND B.STATUS = 'Y'

	</entry>
	
	<entry key="selectCategoryList">
		SELECT
			CATEGORY_NO, CATEGORY_NAME
		FROM CATEGORY
	</entry>
	
	<entry key="insertBoard">
		INSERT INTO BOARD
		VALUES(SEQ_BNO.NEXTVAL, ?, ?, ?, ?, ?, DEFAULT, DEFAULT, DEFAULT)
	</entry>
	
	<entry key="insertAttachment">
		INSERT INTO ATTACHMENT
		VALUES(SEQ_FNO.NEXTVAL, SEQ_BNO.CURRVAL, ?, ?, ?, DEFAULT,'', DEFAULT )
	</entry>
	
	<entry key="updateBoard">
		UPDATE BOARD
			SET CATEGORY_NO= ?,
				BOARD_TITLE =?,
				BOARD_CONTENT=?
		WHERE STATUS ='Y'
		AND BOARD_NO =?
	</entry>
	
	<!-- 첨부파일 수정하기  -->
	<!--
		1) 기존에 첨부파일이 존재하면서 이를 다른 파일로 교체하고자 하는 경우
	 -->
	<entry key="updateAttachment">
		UPDATE ATTACHMENT
			SET ORIGIN_NAME = ?,
				CHANGE_NAME = ?
		WHERE FILE_NO = ?
	</entry>
	
	<!--
		2) 기존에 첨부파일이 존재하지 않는 상황에서 새로운 파일을 수정시 등록하는 경우
	 -->
	<entry key="insertNewAttachment">
		INSERT INTO ATTACHMENT
		VALUES(SEQ_FNO.NEXTVAL, ?, ?, ?, ?, DEFAULT, DEFAULT, DEFAULT )
	</entry>
	
	<!--
		3) 기존에 첨부파일이 존재했는데, 삭제하고자 하는 경우
		REF_BNO
	 -->	
	
	<entry key="deleteAttachment">
		UPDATE ATTACHMENT
			SET STATUS ='N'
		WHERE FILE_NO = ?
	</entry>
	
	
	<entry key="deleteBoard">
		UPDATE BOARD
			SET STATUS='N'
		WHERE STATUS ='Y'
		AND BOARD_NO =?
	</entry>
	
	
	<entry key="increaseCount">
	UPDATE BOARD
	SET COUNT = COUNT + 1
	WHERE STATUS ='Y'
	AND NOTICE_NO = ?
	</entry>
	
	<entry key="selectThumbList">
	SELECT 
	    BOARD_NO, BOARD_TITLE, COUNT, FILE_PATH, CHANGE_NAME
	FROM BOARD B
	JOIN ATTACHMENT A ON BOARD_NO = REF_BNO AND A.STATUS ='Y'
	WHERE FILE_LEVEL =1
	  AND BOARD_TYPE = 2
	  AND B.STATUS = 'Y'
	</entry>
	
	<entry key="insertAttachment">
		INSERT INTO ATTACHMENT
		VALUES(SEQ_FNO.NEXTVAL, SEQ_BNO.CURRVAL,?,?,?,DEFAULT,?,DEFAULT)
	</entry>
	
	<entry key="selectAttachmentList">
		SELECT
			CHANGE_NAME,
			FILE_PATH,
			ORIGIN_NAME,
			FILE_NO,
			FILE_LEVEL
		FROM ATTACHMENT
		WHERE REF_BNO = ?
		  AND STATUS = 'Y'
	</entry>
	
	<entry key="insertReply">
		INSERT INTO REPLY
		VALUES (SEQ_RNO.NEXTVAL,?,?,?,DEFAULT,DEFAULT)
	</entry>
	
	<entry key="replyList">
		SELECT 
			REPLY_NO,
			REPLY_CONTENT,
			USER_ID,
			CREATE_DATE
		FROM REPLY R
		JOIN MEMBER M ON USER_NO = REPLY_WRITER
		WHERE REF_BNO = ?
		AND R.STATUS ='Y'
		ORDER BY CREATE_DATE DESC
	</entry>

</properties>